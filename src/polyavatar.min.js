(function(a,b){"function"==typeof define&&define.amd?define([],b("PolygonAvatar")):"object"==typeof exports?module.exports=b("PolygonAvatar"):a.PolygonAvatar=b("PolygonAvatar")})(this,function(){'use strict';var a=Math.min,b=Math.max,c=Math.PI;function d(a,b,c,d){var e=0,f=b[e++],g=b[e];const h=b.length;for(a.lineCap="butt",a.moveTo((f.x+g.x)/2,(f.y+g.y)/2);e<=h;)f=g,g=b[++e%h],a.arcTo(f.x,f.y,(f.x+g.x)/2,(f.y+g.y)/2,c/d)}function e(a,b,d,e,f,h){a.beginPath(),a.arc(b,d,e,0,2*c,!1),a.fillStyle=f,a.fill(),a.lineWidth=e/4.5,a.strokeStyle=void 0===h?g(a.fillStyle,-30):h,a.stroke()}function f(a,b,c,d){a.setTransform(1,0,0,1,c,c),a.font=d+"px Arial",a.beginPath(),a.fillStyle="white",a.fillText(b,0-d/2,0+d/2.5),a.fill()}function g(c,d){return"#"+c.replace(/^#/,"").replace(/../g,c=>("0"+a(255,b(0,parseInt(c,16)+d)).toString(16)).substr(-2))}function h(a){this.options=k(j,a),this.init()}var j={selector:".polyavatar",classToAdd:"loaded",sides:6,percentage:.98,rotation:.5*-c,image:"",animated:!0,hasImage:!1,showProgress:!0,border:!0,progressBarColor:"#4ff461",borderColor:"#1d2333",progressBgColor:"#293249",onlineColor:"#40d04f",offlineColor:"#888888",levelBgColor:"#7750f8"},k=function(a,b){var c,d={};for(c in j)Object.prototype.hasOwnProperty.call(j,c)&&(d[c]=j[c]);for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c]);return d},l=function(a,b){return{x:a,y:b}},m=function(a,b,d,e=0){var f=Math.sin,g=Math.cos,h=0;const j=2*c/a,k=[];for(;h<a;){var m=l(g(h*j+e)*b+d,f(h++*j+e)*b+d);k.push(m)}return k},n=function(a,b,c,d,e){var f;return a instanceof Image?f=a:(f=new Image,f.src=a),f.complete?o(b,c,d,f,e):f.onload=function(){o(b,c,d,f,e)},f},o=function(a,b,c,d,e){var f=d.width,g=d.height,h=b/f,i=b/g,j=i>h?i:h,k=f*j*(0===e?1:.85-b/e/100),l=g*j*(0===e?1:.85-b/e/100),m=-(k/2)+e,n=-(l/2)+e;c.save(),c.clip(),a.clip?a.checkSupportCompositeMode(c,"destination-in")?(c.drawImage(d,0,0,f,g,m,n,k,l),a.makeClipMask.call(a)):(a.makeClipMask.call(a),c.drawImage(d,0,0,f,g,m,n,k,l)):c.drawImage(d,0,0,f,g,m,n,k,l),c.restore()},p=function(a,b,c,e,f,g,h,i){a.setTransform(1,0,0,1,b,c),a.lineWidth=i,a.lineCap="round",a.strokeStyle=h,a.beginPath(),d(a,e,f,g),a.closePath(),a.stroke()},q=function(a,b,c,e,f,g,h,i,j,k){b.setTransform(1,0,0,1,e,f),b.fillStyle=j,b.beginPath(),d(b,g,h,i),b.fill(),void 0!==k&&o(a,h,b,k,c)},r=function(a,b,c,d,f,g,h){b.lineDashOffset=1;var i=a.width/4,j=a.height-a.height/4;b.setTransform(1,0,0,1,c,d),e(b,i,j,f,g,h)},s=function(a,b,c,d,e,g,h,i,j,k,l,n,o,u,v,w){void 0===v&&null==w&&(w=0,v=t(a,c.percentage));var x=w%1;if(!1===c.animated&&(x=v),b.setTransform(1,0,0,1,0,0),b.clearRect(0,0,a.width,a.height),q(a,b,d,e,e,g,k,o,c.borderColor),q(a,b,d,e,e,h,k,o,c.progressBgColor),q(a,b,d,e,e,i,k,o-2*(l*n),"#000",c.img),b.lineDashOffset=u-x*u,!0===c.showProgress&&(!0===c.animated?(p(b,e,e,j,k,o-l*n,c.progressBarColor,l),x<v&&(w+=.01,requestAnimationFrame(function(){s(a,b,c,d,e,g,h,i,j,k,l,n,o,u,v,w,c.progressBarColor)}))):p(b,e,e,j,k,o-l*n,c.progressBarColor,l)),void 0!==c.online&&r(a,b,0,0,a.width/12,c.online?c.onlineColor:c.offlineColor,c.borderColor),4<c.sides&&0<d&&0<c.levelNumber){var y=e/3,z=k-k/3.65;const g=m(c.sides,y,1,c.rotation),h=m(c.sides,.8*y,1,c.rotation);q(a,b,d,z,z,g,k,o,c.borderColor),q(a,b,d,z,z,h,k,o,c.levelBgColor),f(b,c.levelNumber,z,y)}},t=function(a,b){var c=b;return a.dataset.percentage&&j.percentage===b&&(c=parseFloat(a.dataset.percentage)),1<=c&&(c=j.percentage),c};return h.prototype={init:function(){this.elements=document.querySelectorAll(this.options.selector),this.options.hasImage=""!==this.options.image,3>this.options.sides&&(this.options.sides=3);for(var a=0;a<this.elements.length;a++){const d=this.elements[a];d.classList.add(this.options.classToAdd);const e=d.width,f=e/24,g=!0===this.options.border?10*(e/100):0,h=2*f+10,i=e/2-g,k=.5,l=i-f*k,o=2*(l*c)*j.percentage,p=m(this.options.sides,e/2,g,this.options.rotation),q=m(this.options.sides,i,g,this.options.rotation),r=m(this.options.sides,i-2*f*k,g,this.options.rotation),t=m(this.options.sides,l,g,this.options.rotation),u=d.getContext("2d");u.setLineDash([o]);var b=this;!0===b.options.hasImage?(b.options.img=n(b.options.image,d,e,u,g),b.options.img.onload=function(){s(d,u,b.options,g,i,p,q,r,t,e,f,k,h,o)}):s(d,u,b.options,g,i,p,q,r,t,e,f,k,h,o)}},destroy:function(){},showOptions:function(){console.log(this.options)}},h});