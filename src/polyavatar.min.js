(function(a,b){"function"==typeof define&&define.amd?define([],b("PolygonAvatar")):"object"==typeof exports?module.exports=b("PolygonAvatar"):a.PolygonAvatar=b("PolygonAvatar")})(this,function(){'use strict';var f=Math.min,g=Math.max,h=Math.PI;function a(a,b,c,d){var e=0,f=b[e++],g=b[e];const h=b.length;for(a.lineCap="butt",a.moveTo((f.x+g.x)/2,(f.y+g.y)/2);e<=h;)f=g,g=b[++e%h],a.arcTo(f.x,f.y,(f.x+g.x)/2,(f.y+g.y)/2,c/d)}function b(a,b,c,e,f,g){a.beginPath(),a.arc(b,c,e,0,2*h,!1),a.fillStyle=f,a.fill(),a.lineWidth=e/4.5,a.strokeStyle=void 0===g?d(a.fillStyle,-30):g,a.stroke()}function c(a,b,c,d){a.setTransform(1,0,0,1,c,c),a.font=d+"px Arial",a.beginPath(),a.fillStyle="white",a.fillText(b,0-d/2,0+d/2.5),a.fill()}function d(a,b){return"#"+a.replace(/^#/,"").replace(/../g,a=>("0"+f(255,g(0,parseInt(a,16)+b)).toString(16)).substr(-2))}function e(a){this.options=l(k,a),this.init()}var j="#4ff461",k={selector:".polyavatar",classToAdd:"loaded",sides:6,percentage:.98,rotation:.5*-h,image:"",animated:!0,hasImage:!1,showProgress:!0,border:!0,progressBarColor:j},l=function(a,b){var c,d={};for(c in k)Object.prototype.hasOwnProperty.call(k,c)&&(d[c]=k[c]);for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&(d[c]=b[c]);return d},m=function(a,b){return{x:a,y:b}},n=function(a,b,c,d=0){var e=Math.sin,f=Math.cos,g=0;const j=2*h/a,k=[];for(;g<a;){var l=m(f(g*j+d)*b+c,e(g++*j+d)*b+c);k.push(l)}return k},o=function(a,b,c,d,e){var f;return a instanceof Image?f=a:(f=new Image,f.src=a),f.complete?p(b,c,d,f,e):f.onload=function(){p(b,c,d,f,e)},f},p=function(a,b,c,d,e){var f=d.width,g=d.height,h=b/f,i=b/g,j=i>h?i:h,k=f*j*(0===e?1:.85-b/e/100),l=g*j*(0===e?1:.85-b/e/100),m=-(k/2)+e,n=-(l/2)+e;c.save(),c.clip(),a.clip?a.checkSupportCompositeMode(c,"destination-in")?(c.drawImage(d,0,0,f,g,m,n,k,l),a.makeClipMask.call(a)):(a.makeClipMask.call(a),c.drawImage(d,0,0,f,g,m,n,k,l)):c.drawImage(d,0,0,f,g,m,n,k,l),c.restore()},q=function(b,c,d,e,f,g,h,i){b.setTransform(1,0,0,1,c,d),b.lineWidth=i,b.lineCap="round",b.strokeStyle=h,b.beginPath(),a(b,e,f,g),b.closePath(),b.stroke()},r=function(b,c,d,e,f,g,h,i,j,k){c.setTransform(1,0,0,1,e,f),c.fillStyle=j,c.beginPath(),a(c,g,h,i),c.fill(),void 0!==k&&p(b,h,c,k,d)},s=function(a,c,d,e,f,g,h){c.lineDashOffset=1;var i=a.width/4,j=a.height-a.height/4;c.setTransform(1,0,0,1,d,e),b(c,i,j,f,g,h)},t=function(a,b,d,e,f,g,h,i,k,l,m,o,p,v,w,x){void 0===w&&null==x&&(x=0,w=u(a,d.percentage));var y=x%1;if(!1===d.animated&&(y=w),b.setTransform(1,0,0,1,0,0),b.clearRect(0,0,a.width,a.height),r(a,b,e,f,f,g,l,p,"#1d2333"),r(a,b,e,f,f,h,l,p,"#293249"),r(a,b,e,f,f,i,l,p-2*(m*o),"#000",d.img),b.lineDashOffset=v-y*v,!0===d.showProgress&&(!0===d.animated?(q(b,f,f,k,l,p-m*o,j,m),y<w&&(x+=.01,requestAnimationFrame(function(){t(a,b,d,e,f,g,h,i,k,l,m,o,p,v,w,x)}))):q(b,f,f,k,l,p-m*o,j,m)),void 0!==d.online){var z=0<e?"#1d2333":"#293249";s(a,b,0,0,a.width/12,d.online?"#40d04f":"gray",z)}if(4<d.sides&&0<e&&0<d.levelNumber){var A=f/3,B=l-l/3.65;const g=n(d.sides,A,1,d.rotation),h=n(d.sides,.8*A,1,d.rotation);r(a,b,e,B,B,g,l,p,"#1d2333"),r(a,b,e,B,B,h,l,p,"#7750f8"),c(b,d.levelNumber,B,A)}},u=function(a,b){var c=b;return a.dataset.percentage&&k.percentage===b&&(c=parseFloat(a.dataset.percentage)),1<=c&&(c=k.percentage),c};return e.prototype={init:function(){this.elements=document.querySelectorAll(this.options.selector),this.options.hasImage=""!==this.options.image,3>this.options.sides&&(this.options.sides=3),this.options.progressBarColor!==j&&(j=this.options.progressBarColor);for(var a=0;a<this.elements.length;a++){const c=this.elements[a];c.classList.add(this.options.classToAdd);const d=c.width,e=d/24,f=!0===this.options.border?10*(d/100):0,g=2*e+10,i=d/2-f,j=.5,l=i-e*j,m=2*(l*h)*k.percentage,p=n(this.options.sides,d/2,f,this.options.rotation),q=n(this.options.sides,i,f,this.options.rotation),r=n(this.options.sides,i-2*e*j,f,this.options.rotation),s=n(this.options.sides,l,f,this.options.rotation),u=c.getContext("2d");u.setLineDash([m]);var b=this;!0===b.options.hasImage?(b.options.img=o(b.options.image,c,d,u,f),b.options.img.onload=function(){t(c,u,b.options,f,i,p,q,r,s,d,e,j,g,m)}):t(c,u,b.options,f,i,p,q,r,s,d,e,j,g,m)}},destroy:function(){},showOptions:function(){console.log(this.options)}},e});